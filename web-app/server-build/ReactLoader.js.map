{"version":3,"sources":["../server/ReactLoader.js"],"names":["ReactLoader","rootComponentPath","process","env","NODE_ENV","toLowerCase","Root","require","default","HTML","readFileSync","__dirname","toString","req","res","next","location","url","sheet","html","collectStyles","helmet","renderStatic","styledComponentCSS","getStyleTags","reactPrimitiveCSS","getStyleSheets","map","id","textContent","join","status","send","replace","title"],"mappings":";;;;;kBAoBwBA,W;;AAnBxB;;;;AACA;;AACA;;AACA;;AACA;;;;AACA;;AACA;;;;AAEA,IAAIC,0BAAJ;;AACA,IAAIC,QAAQC,GAAR,CAAYC,QAAZ,IAAwBF,QAAQC,GAAR,CAAYC,QAAZ,CAAqBC,WAArB,OAAuC,YAAnE,EAAiF;AAC7EJ,wBAAoB,eAApB;AACH,CAFD,MAEO;AACHA,wBAAoB,aAApB;AACH;;AAED,IAAMK,OAAOC,QAAQN,iBAAR,EAA2BO,OAAxC;AACA,IAAMC,OAAO,aAAGC,YAAH,CAAgBC,YAAY,uBAA5B,EAAqDC,QAArD,EAAb;;AAEA;AACe,SAASZ,WAAT,CAAqBa,GAArB,EAA0BC,GAA1B,EAA+BC,IAA/B,EAAqC;AAChD,QAAMC,WAAWH,IAAII,GAAJ,CAAQL,QAAR,EAAjB;;AAEA,QAAMM,QAAQ,wCAAd;AACA,QAAMC,OAAO,4BAAeD,MAAME,aAAN,CACxB;AAAA;AAAA,UAAc,UAAUJ,QAAxB,EAAkC,SAAS,EAA3C;AACI,sCAAC,IAAD;AADJ,KADwB,CAAf,CAAb;AAKA,QAAMK,SAAS,oBAAOC,YAAP,EAAf,CATgD,CASV;AACtC,QAAMC,qBAAqBL,MAAMM,YAAN,EAA3B;AACA,QAAMC,oBAAoB,4BACrBC,cADqB,GAErBC,GAFqB,CAEjB;AAAA,YAAEC,EAAF,QAAEA,EAAF;AAAA,YAAMC,WAAN,QAAMA,WAAN;AAAA,8BAAoCD,EAApC,SAA0CC,WAA1C;AAAA,KAFiB,EAGrBC,IAHqB,CAGhB,EAHgB,CAA1B;AAIAhB,QAAIiB,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CACIvB,KACKwB,OADL,CACa,oBADb,EACmCZ,OAAOa,KAAP,CAAatB,QAAb,EADnC,EAEKqB,OAFL,CAEa,kBAFb,EAEiCV,qBAAqBE,iBAFtD,EAGKQ,OAHL,CAGa,mBAHb,EAGkCd,IAHlC,CADJ;AAMH","file":"ReactLoader.js","sourcesContent":["// @flow\nimport React from \"react\";\nimport {renderToString} from 'react-dom/server'\nimport {StaticRouter} from \"react-router-dom\";\nimport {ServerStyleSheet, StyleSheetManager} from 'styled-components'\nimport fs from 'fs';\nimport {StyleSheet} from 'react-primitives';\nimport {Helmet} from 'react-helmet';\n\nlet rootComponentPath;\nif (process.env.NODE_ENV && process.env.NODE_ENV.toLowerCase() === \"production\") {\n    rootComponentPath = \"../build/Root\";\n} else {\n    rootComponentPath = \"../src/Root\";\n}\n\nconst Root = require(rootComponentPath).default;\nconst HTML = fs.readFileSync(__dirname + '/../public/index.html').toString();\n\n// todo: add index.html loading\nexport default function ReactLoader(req, res, next) {\n    const location = req.url.toString();\n\n    const sheet = new ServerStyleSheet();\n    const html = renderToString(sheet.collectStyles(\n        <StaticRouter location={location} context={{}}>\n            <Root/>\n        </StaticRouter>\n    ));\n    const helmet = Helmet.renderStatic(); // use renderStatic to prevent memory leak\n    const styledComponentCSS = sheet.getStyleTags();\n    const reactPrimitiveCSS = StyleSheet\n        .getStyleSheets()\n        .map(({id, textContent}) => `<style id=${id}>${textContent}</style>`)\n        .join('');\n    res.status(200).send(\n        HTML\n            .replace(/<!-- SSR:title -->/, helmet.title.toString())\n            .replace(/<!-- SSR:CSS -->/, styledComponentCSS + reactPrimitiveCSS)\n            .replace(/<!-- SSR:HTML -->/, html)\n    );\n}\n"]}